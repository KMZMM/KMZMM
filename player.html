<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Fullscreen Video Player</title>
<style>
  html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    background: black;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }
  #videoContainer {
    width: 100vw;
    height: 100vh;
    display: none; /* show once ready */
    justify-content: center;
    align-items: center;
    position: relative;
    background: black;
  }
  video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: black;
    -webkit-tap-highlight-color: transparent; /* iOS */
  }
  #instructions {
    position: absolute;
    color: white;
    font-size: 16px;
    z-index: 20;
    top: 10px;
    width: 100%;
    text-align: center;
    padding: 10px;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(8px);
    user-select: none;
  }
  /* iOS style progress bar container */
  #progressContainer {
    position: absolute;
    bottom: 10px;
    left: 15px;
    right: 15px;
    height: 6px;
    background: rgba(white, 0.15);
    border-radius: 3px;
    box-shadow: inset 0 1px 1px rgba(255,255,255,0.2);
    display: none;
    z-index: 15;
  }
  #progressBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #0a84ff, #5ac8fa);
    border-radius: 3px;
    transition: width 0.25s ease;
  }
  /* Loading spinner */
  #loading {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 50px; height: 50px;
    border: 5px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #0a84ff;
    animation: spin 1s ease-in-out infinite;
    z-index: 30;
    display: none;
  }
  @keyframes spin {
    to { transform: translate(-50%, -50%) rotate(360deg); }
  }
  /* Error message */
  #error {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    text-align: center;
    display: none;
    background: rgba(0, 0, 0, 0.7);
    padding: 20px;
    border-radius: 12px;
    user-select:none;
    z-index: 40;
  }
  /* Orientation prompt for mobile */
  #orientationPrompt {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 100;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: white;
    text-align: center;
    padding: 20px;
    user-select:none;
  }
  #orientationPrompt svg {
    margin-bottom: 20px;
    width: 70px;
    height: 70px;
    fill: white;
  }
  /* iOS-style rotate device icon */
  #orientationPrompt svg path {
    stroke: white;
    stroke-width: 1.2;
  }
  /* Fullscreen toggle button (top-right) */
  #fullscreenToggle {
    position: fixed;
    top: 12px;
    right: 12px;
    width: 34px;
    height: 34px;
    background: rgba(10, 132, 255, 0.85);
    border-radius: 17px;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 50;
    -webkit-tap-highlight-color: transparent;
  }
  #fullscreenToggle svg {
    width: 20px;
    height: 20px;
    fill: white;
  }
</style>
</head>
<body>
  <div id="instructions">Tap the video to unmute and enter fullscreen</div>
  <div id="loading"></div>
  <div id="progressContainer"><div id="progressBar"></div></div>
  <div id="error"></div>
  <div id="orientationPrompt">
    <!-- Updated iOS style rotate icon -->
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" >
      <path d="M17.7 5.3a8 8 0 1 0 0 11.4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <polyline points="21 3 21 9 15 9" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>
    </svg>
    <h2>Please rotate your device</h2>
    <p>For the best viewing experience, please switch to landscape mode</p>
  </div>
  <div id="videoContainer">
    <video id="video" autoplay playsinline muted>
      <source id="videoSource" src="" type="video/mp4" />
      Your browser does not support HTML5 video.
    </video>
  </div>
  <div id="fullscreenToggle" title="Exit Fullscreen (Tap to toggle)">
    <!-- iOS style minimize fullscreen icon -->
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
      <path d="M4 4h6M4 4v6M20 20h-6M20 20v-6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
    </svg>
  </div>
<script>
  const video = document.getElementById('video');
  const source = document.getElementById('videoSource');
  const container = document.getElementById('videoContainer');
  const instructions = document.getElementById('instructions');
  const loading = document.getElementById('loading');
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progressBar');
  const errorElement = document.getElementById('error');
  const orientationPrompt = document.getElementById('orientationPrompt');
  const fullscreenToggle = document.getElementById('fullscreenToggle');

  const params = new URLSearchParams(window.location.search);
  const videoUrl = params.get('video');

  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

  // Show loading spinner and set video source if url provided
  if(videoUrl){
    loading.style.display = 'block';
    source.src = decodeURIComponent(videoUrl);
    video.load();

    video.addEventListener('loadedmetadata', () => {
      container.style.display = 'flex';
      loading.style.display = 'none';

      if(isMobile) progressContainer.style.display = 'block';

      video.play().catch(e => {
        instructions.textContent = 'Tap to play video';
      });

      // Try initial fullscreen in portrait to hide browser chrome if possible
      if(screen.orientation && screen.orientation.lock){
        screen.orientation.lock('portrait').catch(() => {
          // fallback, ignore error
        });
      }
    });

    video.addEventListener('progress', () => {
      if (video.buffered.length > 0) {
        const percent = (video.buffered.end(0) / video.duration) * 100;
        progressBar.style.width = percent + '%';
      }
    });

    video.addEventListener('error', () => {
      loading.style.display = 'none';
      errorElement.style.display = 'block';
      errorElement.textContent = 'Error loading video. Please check the URL.';
    });
  } else {
    errorElement.style.display = 'block';
    errorElement.textContent = 'No video URL provided!';
  }

  // Fullscreen & Unmute on first tap
  // Also adjust instructions visibility and show fullscreen toggle after fullscreen enters
  const enableFullscreenAndSound = async () => {
    video.muted = false;
    try {
      if(video.requestFullscreen){
        await video.requestFullscreen();
      }
      else if(video.webkitEnterFullscreen){ // iOS
        video.webkitEnterFullscreen();
      }
      else if(video.webkitRequestFullscreen){
        await video.webkitRequestFullscreen();
      }
    }
    catch(e){
      console.log('Fullscreen request failed:', e);
    }
    instructions.style.display = 'none';
    fullscreenToggle.style.display = 'flex';
    video.removeEventListener('click', enableFullscreenAndSound);
  };
  video.addEventListener('click', enableFullscreenAndSound);

  // Fullscreen toggle button click handler - toggle fullscreen exit/enter
  fullscreenToggle.addEventListener('click', async () => {
    if(document.fullscreenElement || document.webkitFullscreenElement){
      // Exit fullscreen
      if(document.exitFullscreen){
        await document.exitFullscreen();
      } else if(document.webkitExitFullscreen){
        document.webkitExitFullscreen();
      }
    } else {
      // Enter fullscreen
      try {
        if(video.requestFullscreen){
          await video.requestFullscreen();
        } else if(video.webkitEnterFullscreen){
          video.webkitEnterFullscreen();
        }
      } catch(e) {
        console.log('Fullscreen toggle failed:', e);
      }
    }
  });

  // Listen for fullscreen change events to toggle visibility and instructions appropriately
  document.addEventListener('fullscreenchange', () => {
    if (document.fullscreenElement === video) {
      fullscreenToggle.style.display = 'flex';
      instructions.style.display = 'none';
    } else {
      fullscreenToggle.style.display = 'none';
      instructions.style.display = 'block';
    }
  });
  document.addEventListener('webkitfullscreenchange', () => {
    if(document.webkitFullscreenElement === video){
      fullscreenToggle.style.display = 'flex';
      instructions.style.display = 'none';
    } else {
      fullscreenToggle.style.display = 'none';
      instructions.style.display = 'block';
    }
  });

  // Orientation handling and prompt for mobile
  function handleOrientation() {
    if(screen.orientation && screen.orientation.lock){
      screen.orientation.lock('landscape').catch(() => {
        if(isMobile && window.innerHeight > window.innerWidth){
          orientationPrompt.style.display = 'flex';
        }
      });
    } else if(isMobile && window.innerHeight > window.innerWidth){
      orientationPrompt.style.display = 'flex';
    }
  }
  handleOrientation();

  window.addEventListener('resize', () => {
    if(isMobile){
      if(window.innerHeight > window.innerWidth){
        orientationPrompt.style.display = 'flex';
      } else {
        orientationPrompt.style.display = 'none';
      }
    }
  });
  orientationPrompt.addEventListener('click', () => {
    orientationPrompt.style.display = 'none';
  });
</script>
</body>
</html>
